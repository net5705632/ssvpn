name: Generate and Export SS Files

on:
  schedule:
    - cron: '0 23 * * *'  # UTC时间23点（北京时间早7点）
  workflow_dispatch:  # 允许手动触发

permissions:
  contents: write  # 需要写入权限以提交文件到仓库

jobs:
  generate-ss:
    runs-on: ubuntu-latest
    env:
      TZ: Asia/Shanghai  # 设置时区
    steps:
    - name: 检出代码
      uses: actions/checkout@v4

    - name: 安装 Python
      uses: actions/setup-python@v4
      with:
        python-version: "3.12"

    - name: 安装依赖
      run: |
        python -m pip install --upgrade pip
        if [ -f requirements.txt ]; then pip install -r requirements.txt; fi

    - name: 运行 ss12.py 生成文件
      run: |
        python ss12.py  # 确保脚本路径正确

    - name: 提交生成的 SS 文件到仓库
      run: |
        git config --global user.name "GitHub Actions"
        git config --global user.email "actions@github.com"
        git add SS_*.txt  # 根据实际生成的文件名修改（例如 SS_20231101.txt）
        git commit -m "Auto-commit: Add SS file generated by workflow"
        git push
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}  # 使用内置Token推送
